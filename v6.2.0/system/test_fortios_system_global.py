# Copyright 2019 Fortinet, Inc.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Ansible.  If not, see <https://www.gnu.org/licenses/>.

# Make coding more python3-ish
from __future__ import (absolute_import, division, print_function)
__metaclass__ = type

import os
import json
import pytest
from mock import ANY
from ansible.module_utils.network.fortios.fortios import FortiOSHandler

try:
    from ansible.modules.network.fortios import fortios_system_global
except ImportError:
    pytest.skip("Could not load required modules for testing", allow_module_level=True)


@pytest.fixture(autouse=True)
def connection_mock(mocker):
    connection_class_mock = mocker.patch('ansible.modules.network.fortios.fortios_system_global.Connection')
    return connection_class_mock


fos_instance = FortiOSHandler(connection_mock)


def test_system_global_creation(mocker):
    schema_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.schema')

    set_method_result = {'status': 'success', 'http_method': 'POST', 'http_status': 200}
    set_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.set', return_value=set_method_result)

    input_data = {
        'username': 'admin',
        'state': 'present',
        'system_global': {
            'admin_concurrent': 'enable',
            'admin_console_timeout': '4',
            'admin_hsts_max_age': '5',
            'admin_http_connection_receive_timeout': '6',
            'admin_https_pki_required': 'enable',
            'admin_https_redirect': 'enable',
            'admin_lockout_duration': '9',
            'admin_lockout_threshold': '10',
            'admin_login_max': '11',
            'admin_maintainer': 'enable',
            'admin_port': '13',
            'admin_restrict_local': 'enable',
            'admin_scp': 'enable',
            'admin_server_cert': 'test_value_16',
            'admin_sport': '17',
            'admin_ssh_grace_time': '18',
            'admin_ssh_password': 'enable',
            'admin_ssh_port': '20',
            'admin_ssh_v1': 'enable',
            'admin_telnet': 'enable',
            'admin_telnet_port': '23',
            'admintimeout': '24',
            'alias': 'test_value_25',
            'allow_traffic_redirect': 'enable',
            'anti_replay': 'disable',
            'arp_max_entry': '28',
            'auth_cert': 'test_value_29',
            'auth_http_port': '30',
            'auth_https_port': '31',
            'auth_keepalive': 'enable',
            'auth_session_limit': 'block-new',
            'auto_auth_extension_device': 'enable',
            'autorun_log_fsck': 'enable',
            'av_affinity': 'test_value_36',
            'av_failopen': 'pass',
            'av_failopen_session': 'enable',
            'batch_cmdb': 'enable',
            'block_session_timer': '40',
            'br_fdb_max_entry': '41',
            'cert_chain_max': '42',
            'cfg_revert_timeout': '43',
            'cfg_save': 'automatic',
            'check_protocol_header': 'loose',
            'check_reset_range': 'strict',
            'cli_audit_log': 'enable',
            'cloud_communication': 'enable',
            'clt_cert_req': 'enable',
            'compliance_check': 'enable',
            'compliance_check_time': 'test_value_51',
            'cpu_use_threshold': '52',
            'csr_ca_attribute': 'enable',
            'daily_restart': 'enable',
            'default_service_source_port': 'test_value_55',
            'device_identification_active_scan_delay': '56',
            'device_idle_timeout': '57',
            'dh_params': '1024',
            'dnsproxy_worker_count': '59',
            'dst': 'enable',
            'endpoint_control_fds_access': 'enable',
            'failtime': '62',
            'fds_statistics': 'enable',
            'fds_statistics_period': '64',
            'fec_port': '65',
            'fortiextender': 'disable',
            'fortiextender_data_port': '67',
            'fortiextender_vlan_mode': 'enable',
            'fortiservice_port': '69',
            'fortitoken_cloud_service': 'enable',
            'gui_certificates': 'enable',
            'gui_custom_language': 'enable',
            'gui_date_format': 'yyyy/MM/dd',
            'gui_date_time_source': 'system',
            'gui_device_latitude': 'test_value_75',
            'gui_device_longitude': 'test_value_76',
            'gui_display_hostname': 'enable',
            'gui_ipv6': 'enable',
            'gui_lines_per_page': '79',
            'gui_theme': 'green',
            'gui_wireless_opensecurity': 'enable',
            'honor_df': 'enable',
            'hostname': 'myhostname83',
            'igmp_state_limit': '84',
            'interval': '85',
            'ip_src_port_range': 'test_value_86',
            'ips_affinity': 'test_value_87',
            'ipsec_asic_offload': 'enable',
            'ipsec_hmac_offload': 'enable',
            'ipsec_soft_dec_async': 'enable',
            'ipv6_accept_dad': '91',
            'ipv6_allow_anycast_probe': 'enable',
            'language': 'english',
            'ldapconntimeout': '94',
            'lldp_reception': 'enable',
            'lldp_transmission': 'enable',
            'log_ssl_connection': 'enable',
            'log_uuid_address': 'enable',
            'log_uuid_policy': 'enable',
            'login_timestamp': 'enable',
            'long_vdom_name': 'enable',
            'management_vdom': 'test_value_102',
            'max_dlpstat_memory': '103',
            'max_route_cache_size': '104',
            'memory_use_threshold_extreme': '105',
            'memory_use_threshold_green': '106',
            'memory_use_threshold_red': '107',
            'miglog_affinity': 'test_value_108',
            'miglogd_children': '109',
            'multi_factor_authentication': 'optional',
            'ndp_max_entry': '111',
            'per_user_bwl': 'enable',
            'policy_auth_concurrent': '113',
            'post_login_banner': 'disable',
            'pre_login_banner': 'enable',
            'private_data_encryption': 'disable',
            'proxy_auth_lifetime': 'enable',
            'proxy_auth_lifetime_timeout': '118',
            'proxy_auth_timeout': '119',
            'proxy_cipher_hardware_acceleration': 'disable',
            'proxy_kxp_hardware_acceleration': 'disable',
            'proxy_re_authentication_mode': 'session',
            'proxy_worker_count': '123',
            'radius_port': '124',
            'reboot_upon_config_restore': 'enable',
            'refresh': '126',
            'remoteauthtimeout': '127',
            'reset_sessionless_tcp': 'enable',
            'restart_time': 'test_value_129',
            'revision_backup_on_logout': 'enable',
            'revision_image_auto_backup': 'enable',
            'scanunit_count': '132',
            'security_rating_result_submission': 'enable',
            'security_rating_run_on_schedule': 'enable',
            'send_pmtu_icmp': 'enable',
            'snat_route_change': 'enable',
            'special_file_23_support': 'disable',
            'ssd_trim_date': '138',
            'ssd_trim_freq': 'never',
            'ssd_trim_hour': '140',
            'ssd_trim_min': '141',
            'ssd_trim_weekday': 'sunday',
            'ssh_cbc_cipher': 'enable',
            'ssh_hmac_md5': 'enable',
            'ssh_kex_sha1': 'enable',
            'ssh_mac_weak': 'enable',
            'ssl_min_proto_version': 'SSLv3',
            'ssl_static_key_ciphers': 'enable',
            'sslvpn_cipher_hardware_acceleration': 'enable',
            'sslvpn_kxp_hardware_acceleration': 'enable',
            'sslvpn_max_worker_count': '151',
            'sslvpn_plugin_version_check': 'enable',
            'strict_dirty_session_check': 'enable',
            'strong_crypto': 'enable',
            'switch_controller': 'disable',
            'switch_controller_reserved_network': 'test_value_156',
            'sys_perf_log_interval': '157',
            'tcp_halfclose_timer': '158',
            'tcp_halfopen_timer': '159',
            'tcp_option': 'enable',
            'tcp_timewait_timer': '161',
            'tftp': 'enable',
            'timezone': '01',
            'traffic_priority': 'tos',
            'traffic_priority_level': 'low',
            'two_factor_email_expiry': '166',
            'two_factor_fac_expiry': '167',
            'two_factor_ftk_expiry': '168',
            'two_factor_ftm_expiry': '169',
            'two_factor_sms_expiry': '170',
            'udp_idle_timer': '171',
            'user_server_cert': 'test_value_172',
            'vdom_mode': 'no-vdom',
            'vip_arp_range': 'unlimited',
            'virtual_server_count': '175',
            'virtual_server_hardware_acceleration': 'disable',
            'wad_affinity': 'test_value_177',
            'wad_csvc_cs_count': '178',
            'wad_csvc_db_count': '179',
            'wad_memory_change_granularity': '180',
            'wad_source_affinity': 'disable',
            'wad_worker_count': '182',
            'wifi_ca_certificate': 'test_value_183',
            'wifi_certificate': 'test_value_184',
            'wimax_4g_usb': 'enable',
            'wireless_controller': 'enable',
            'wireless_controller_port': '187'
        },
        'vdom': 'root'}

    is_error, changed, response = fortios_system_global.fortios_system(input_data, fos_instance)

    expected_data = {
        'admin-concurrent': 'enable',
        'admin-console-timeout': '4',
        'admin-hsts-max-age': '5',
        'admin-http-connection-receive-timeout': '6',
        'admin-https-pki-required': 'enable',
        'admin-https-redirect': 'enable',
        'admin-lockout-duration': '9',
        'admin-lockout-threshold': '10',
        'admin-login-max': '11',
        'admin-maintainer': 'enable',
        'admin-port': '13',
        'admin-restrict-local': 'enable',
        'admin-scp': 'enable',
        'admin-server-cert': 'test_value_16',
        'admin-sport': '17',
        'admin-ssh-grace-time': '18',
        'admin-ssh-password': 'enable',
        'admin-ssh-port': '20',
        'admin-ssh-v1': 'enable',
        'admin-telnet': 'enable',
        'admin-telnet-port': '23',
        'admintimeout': '24',
        'alias': 'test_value_25',
        'allow-traffic-redirect': 'enable',
        'anti-replay': 'disable',
        'arp-max-entry': '28',
        'auth-cert': 'test_value_29',
        'auth-http-port': '30',
        'auth-https-port': '31',
        'auth-keepalive': 'enable',
        'auth-session-limit': 'block-new',
        'auto-auth-extension-device': 'enable',
        'autorun-log-fsck': 'enable',
        'av-affinity': 'test_value_36',
        'av-failopen': 'pass',
        'av-failopen-session': 'enable',
        'batch-cmdb': 'enable',
        'block-session-timer': '40',
        'br-fdb-max-entry': '41',
        'cert-chain-max': '42',
        'cfg-revert-timeout': '43',
        'cfg-save': 'automatic',
        'check-protocol-header': 'loose',
        'check-reset-range': 'strict',
        'cli-audit-log': 'enable',
        'cloud-communication': 'enable',
        'clt-cert-req': 'enable',
        'compliance-check': 'enable',
        'compliance-check-time': 'test_value_51',
        'cpu-use-threshold': '52',
        'csr-ca-attribute': 'enable',
        'daily-restart': 'enable',
        'default-service-source-port': 'test_value_55',
        'device-identification-active-scan-delay': '56',
        'device-idle-timeout': '57',
        'dh-params': '1024',
        'dnsproxy-worker-count': '59',
        'dst': 'enable',
        'endpoint-control-fds-access': 'enable',
        'failtime': '62',
        'fds-statistics': 'enable',
        'fds-statistics-period': '64',
        'fec-port': '65',
        'fortiextender': 'disable',
        'fortiextender-data-port': '67',
        'fortiextender-vlan-mode': 'enable',
        'fortiservice-port': '69',
        'fortitoken-cloud-service': 'enable',
        'gui-certificates': 'enable',
        'gui-custom-language': 'enable',
        'gui-date-format': 'yyyy/MM/dd',
        'gui-date-time-source': 'system',
        'gui-device-latitude': 'test_value_75',
        'gui-device-longitude': 'test_value_76',
        'gui-display-hostname': 'enable',
        'gui-ipv6': 'enable',
        'gui-lines-per-page': '79',
        'gui-theme': 'green',
        'gui-wireless-opensecurity': 'enable',
        'honor-df': 'enable',
        'hostname': 'myhostname83',
        'igmp-state-limit': '84',
        'interval': '85',
        'ip-src-port-range': 'test_value_86',
        'ips-affinity': 'test_value_87',
        'ipsec-asic-offload': 'enable',
        'ipsec-hmac-offload': 'enable',
        'ipsec-soft-dec-async': 'enable',
        'ipv6-accept-dad': '91',
        'ipv6-allow-anycast-probe': 'enable',
        'language': 'english',
        'ldapconntimeout': '94',
        'lldp-reception': 'enable',
        'lldp-transmission': 'enable',
        'log-ssl-connection': 'enable',
        'log-uuid-address': 'enable',
        'log-uuid-policy': 'enable',
        'login-timestamp': 'enable',
        'long-vdom-name': 'enable',
        'management-vdom': 'test_value_102',
        'max-dlpstat-memory': '103',
        'max-route-cache-size': '104',
        'memory-use-threshold-extreme': '105',
        'memory-use-threshold-green': '106',
        'memory-use-threshold-red': '107',
        'miglog-affinity': 'test_value_108',
        'miglogd-children': '109',
        'multi-factor-authentication': 'optional',
        'ndp-max-entry': '111',
        'per-user-bwl': 'enable',
        'policy-auth-concurrent': '113',
        'post-login-banner': 'disable',
        'pre-login-banner': 'enable',
        'private-data-encryption': 'disable',
        'proxy-auth-lifetime': 'enable',
        'proxy-auth-lifetime-timeout': '118',
        'proxy-auth-timeout': '119',
        'proxy-cipher-hardware-acceleration': 'disable',
        'proxy-kxp-hardware-acceleration': 'disable',
        'proxy-re-authentication-mode': 'session',
        'proxy-worker-count': '123',
        'radius-port': '124',
        'reboot-upon-config-restore': 'enable',
        'refresh': '126',
        'remoteauthtimeout': '127',
        'reset-sessionless-tcp': 'enable',
        'restart-time': 'test_value_129',
        'revision-backup-on-logout': 'enable',
        'revision-image-auto-backup': 'enable',
        'scanunit-count': '132',
        'security-rating-result-submission': 'enable',
        'security-rating-run-on-schedule': 'enable',
        'send-pmtu-icmp': 'enable',
        'snat-route-change': 'enable',
        'special-file-23-support': 'disable',
        'ssd-trim-date': '138',
        'ssd-trim-freq': 'never',
        'ssd-trim-hour': '140',
        'ssd-trim-min': '141',
        'ssd-trim-weekday': 'sunday',
        'ssh-cbc-cipher': 'enable',
        'ssh-hmac-md5': 'enable',
        'ssh-kex-sha1': 'enable',
        'ssh-mac-weak': 'enable',
        'ssl-min-proto-version': 'SSLv3',
        'ssl-static-key-ciphers': 'enable',
        'sslvpn-cipher-hardware-acceleration': 'enable',
        'sslvpn-kxp-hardware-acceleration': 'enable',
        'sslvpn-max-worker-count': '151',
        'sslvpn-plugin-version-check': 'enable',
        'strict-dirty-session-check': 'enable',
        'strong-crypto': 'enable',
        'switch-controller': 'disable',
        'switch-controller-reserved-network': 'test_value_156',
        'sys-perf-log-interval': '157',
        'tcp-halfclose-timer': '158',
        'tcp-halfopen-timer': '159',
        'tcp-option': 'enable',
        'tcp-timewait-timer': '161',
        'tftp': 'enable',
                'timezone': '01',
                'traffic-priority': 'tos',
                'traffic-priority-level': 'low',
                'two-factor-email-expiry': '166',
                'two-factor-fac-expiry': '167',
                'two-factor-ftk-expiry': '168',
                'two-factor-ftm-expiry': '169',
                'two-factor-sms-expiry': '170',
                'udp-idle-timer': '171',
                'user-server-cert': 'test_value_172',
                'vdom-mode': 'no-vdom',
                'vip-arp-range': 'unlimited',
                'virtual-server-count': '175',
                'virtual-server-hardware-acceleration': 'disable',
                'wad-affinity': 'test_value_177',
                'wad-csvc-cs-count': '178',
                'wad-csvc-db-count': '179',
                'wad-memory-change-granularity': '180',
                'wad-source-affinity': 'disable',
                'wad-worker-count': '182',
                'wifi-ca-certificate': 'test_value_183',
                'wifi-certificate': 'test_value_184',
                'wimax-4g-usb': 'enable',
                'wireless-controller': 'enable',
                'wireless-controller-port': '187'
    }

    set_method_mock.assert_called_with('system', 'global', data=expected_data, vdom='root')
    schema_method_mock.assert_not_called()
    assert not is_error
    assert changed
    assert response['status'] == 'success'
    assert response['http_status'] == 200


def test_system_global_creation_fails(mocker):
    schema_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.schema')

    set_method_result = {'status': 'error', 'http_method': 'POST', 'http_status': 500}
    set_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.set', return_value=set_method_result)

    input_data = {
        'username': 'admin',
        'state': 'present',
        'system_global': {
            'admin_concurrent': 'enable',
            'admin_console_timeout': '4',
            'admin_hsts_max_age': '5',
            'admin_http_connection_receive_timeout': '6',
            'admin_https_pki_required': 'enable',
            'admin_https_redirect': 'enable',
            'admin_lockout_duration': '9',
            'admin_lockout_threshold': '10',
            'admin_login_max': '11',
            'admin_maintainer': 'enable',
            'admin_port': '13',
            'admin_restrict_local': 'enable',
            'admin_scp': 'enable',
            'admin_server_cert': 'test_value_16',
            'admin_sport': '17',
            'admin_ssh_grace_time': '18',
            'admin_ssh_password': 'enable',
            'admin_ssh_port': '20',
            'admin_ssh_v1': 'enable',
            'admin_telnet': 'enable',
            'admin_telnet_port': '23',
            'admintimeout': '24',
            'alias': 'test_value_25',
            'allow_traffic_redirect': 'enable',
            'anti_replay': 'disable',
            'arp_max_entry': '28',
            'auth_cert': 'test_value_29',
            'auth_http_port': '30',
            'auth_https_port': '31',
            'auth_keepalive': 'enable',
            'auth_session_limit': 'block-new',
            'auto_auth_extension_device': 'enable',
            'autorun_log_fsck': 'enable',
            'av_affinity': 'test_value_36',
            'av_failopen': 'pass',
            'av_failopen_session': 'enable',
            'batch_cmdb': 'enable',
            'block_session_timer': '40',
            'br_fdb_max_entry': '41',
            'cert_chain_max': '42',
            'cfg_revert_timeout': '43',
            'cfg_save': 'automatic',
            'check_protocol_header': 'loose',
            'check_reset_range': 'strict',
            'cli_audit_log': 'enable',
            'cloud_communication': 'enable',
            'clt_cert_req': 'enable',
            'compliance_check': 'enable',
            'compliance_check_time': 'test_value_51',
            'cpu_use_threshold': '52',
            'csr_ca_attribute': 'enable',
            'daily_restart': 'enable',
            'default_service_source_port': 'test_value_55',
            'device_identification_active_scan_delay': '56',
            'device_idle_timeout': '57',
            'dh_params': '1024',
            'dnsproxy_worker_count': '59',
            'dst': 'enable',
            'endpoint_control_fds_access': 'enable',
            'failtime': '62',
            'fds_statistics': 'enable',
            'fds_statistics_period': '64',
            'fec_port': '65',
            'fortiextender': 'disable',
            'fortiextender_data_port': '67',
            'fortiextender_vlan_mode': 'enable',
            'fortiservice_port': '69',
            'fortitoken_cloud_service': 'enable',
            'gui_certificates': 'enable',
            'gui_custom_language': 'enable',
            'gui_date_format': 'yyyy/MM/dd',
            'gui_date_time_source': 'system',
            'gui_device_latitude': 'test_value_75',
            'gui_device_longitude': 'test_value_76',
            'gui_display_hostname': 'enable',
            'gui_ipv6': 'enable',
            'gui_lines_per_page': '79',
            'gui_theme': 'green',
            'gui_wireless_opensecurity': 'enable',
            'honor_df': 'enable',
            'hostname': 'myhostname83',
            'igmp_state_limit': '84',
            'interval': '85',
            'ip_src_port_range': 'test_value_86',
            'ips_affinity': 'test_value_87',
            'ipsec_asic_offload': 'enable',
            'ipsec_hmac_offload': 'enable',
            'ipsec_soft_dec_async': 'enable',
            'ipv6_accept_dad': '91',
            'ipv6_allow_anycast_probe': 'enable',
            'language': 'english',
            'ldapconntimeout': '94',
            'lldp_reception': 'enable',
            'lldp_transmission': 'enable',
            'log_ssl_connection': 'enable',
            'log_uuid_address': 'enable',
            'log_uuid_policy': 'enable',
            'login_timestamp': 'enable',
            'long_vdom_name': 'enable',
            'management_vdom': 'test_value_102',
            'max_dlpstat_memory': '103',
            'max_route_cache_size': '104',
            'memory_use_threshold_extreme': '105',
            'memory_use_threshold_green': '106',
            'memory_use_threshold_red': '107',
            'miglog_affinity': 'test_value_108',
            'miglogd_children': '109',
            'multi_factor_authentication': 'optional',
            'ndp_max_entry': '111',
            'per_user_bwl': 'enable',
            'policy_auth_concurrent': '113',
            'post_login_banner': 'disable',
            'pre_login_banner': 'enable',
            'private_data_encryption': 'disable',
            'proxy_auth_lifetime': 'enable',
            'proxy_auth_lifetime_timeout': '118',
            'proxy_auth_timeout': '119',
            'proxy_cipher_hardware_acceleration': 'disable',
            'proxy_kxp_hardware_acceleration': 'disable',
            'proxy_re_authentication_mode': 'session',
            'proxy_worker_count': '123',
            'radius_port': '124',
            'reboot_upon_config_restore': 'enable',
            'refresh': '126',
            'remoteauthtimeout': '127',
            'reset_sessionless_tcp': 'enable',
            'restart_time': 'test_value_129',
            'revision_backup_on_logout': 'enable',
            'revision_image_auto_backup': 'enable',
            'scanunit_count': '132',
            'security_rating_result_submission': 'enable',
            'security_rating_run_on_schedule': 'enable',
            'send_pmtu_icmp': 'enable',
            'snat_route_change': 'enable',
            'special_file_23_support': 'disable',
            'ssd_trim_date': '138',
            'ssd_trim_freq': 'never',
            'ssd_trim_hour': '140',
            'ssd_trim_min': '141',
            'ssd_trim_weekday': 'sunday',
            'ssh_cbc_cipher': 'enable',
            'ssh_hmac_md5': 'enable',
            'ssh_kex_sha1': 'enable',
            'ssh_mac_weak': 'enable',
            'ssl_min_proto_version': 'SSLv3',
            'ssl_static_key_ciphers': 'enable',
            'sslvpn_cipher_hardware_acceleration': 'enable',
            'sslvpn_kxp_hardware_acceleration': 'enable',
            'sslvpn_max_worker_count': '151',
            'sslvpn_plugin_version_check': 'enable',
            'strict_dirty_session_check': 'enable',
            'strong_crypto': 'enable',
            'switch_controller': 'disable',
            'switch_controller_reserved_network': 'test_value_156',
            'sys_perf_log_interval': '157',
            'tcp_halfclose_timer': '158',
            'tcp_halfopen_timer': '159',
            'tcp_option': 'enable',
            'tcp_timewait_timer': '161',
            'tftp': 'enable',
            'timezone': '01',
            'traffic_priority': 'tos',
            'traffic_priority_level': 'low',
            'two_factor_email_expiry': '166',
            'two_factor_fac_expiry': '167',
            'two_factor_ftk_expiry': '168',
            'two_factor_ftm_expiry': '169',
            'two_factor_sms_expiry': '170',
            'udp_idle_timer': '171',
            'user_server_cert': 'test_value_172',
            'vdom_mode': 'no-vdom',
            'vip_arp_range': 'unlimited',
            'virtual_server_count': '175',
            'virtual_server_hardware_acceleration': 'disable',
            'wad_affinity': 'test_value_177',
            'wad_csvc_cs_count': '178',
            'wad_csvc_db_count': '179',
            'wad_memory_change_granularity': '180',
            'wad_source_affinity': 'disable',
            'wad_worker_count': '182',
            'wifi_ca_certificate': 'test_value_183',
            'wifi_certificate': 'test_value_184',
            'wimax_4g_usb': 'enable',
            'wireless_controller': 'enable',
            'wireless_controller_port': '187'
        },
        'vdom': 'root'}

    is_error, changed, response = fortios_system_global.fortios_system(input_data, fos_instance)

    expected_data = {
        'admin-concurrent': 'enable',
        'admin-console-timeout': '4',
        'admin-hsts-max-age': '5',
        'admin-http-connection-receive-timeout': '6',
        'admin-https-pki-required': 'enable',
        'admin-https-redirect': 'enable',
        'admin-lockout-duration': '9',
        'admin-lockout-threshold': '10',
        'admin-login-max': '11',
        'admin-maintainer': 'enable',
        'admin-port': '13',
        'admin-restrict-local': 'enable',
        'admin-scp': 'enable',
        'admin-server-cert': 'test_value_16',
        'admin-sport': '17',
        'admin-ssh-grace-time': '18',
        'admin-ssh-password': 'enable',
        'admin-ssh-port': '20',
        'admin-ssh-v1': 'enable',
        'admin-telnet': 'enable',
        'admin-telnet-port': '23',
        'admintimeout': '24',
        'alias': 'test_value_25',
        'allow-traffic-redirect': 'enable',
        'anti-replay': 'disable',
        'arp-max-entry': '28',
        'auth-cert': 'test_value_29',
        'auth-http-port': '30',
        'auth-https-port': '31',
        'auth-keepalive': 'enable',
        'auth-session-limit': 'block-new',
        'auto-auth-extension-device': 'enable',
        'autorun-log-fsck': 'enable',
        'av-affinity': 'test_value_36',
        'av-failopen': 'pass',
        'av-failopen-session': 'enable',
        'batch-cmdb': 'enable',
        'block-session-timer': '40',
        'br-fdb-max-entry': '41',
        'cert-chain-max': '42',
        'cfg-revert-timeout': '43',
        'cfg-save': 'automatic',
        'check-protocol-header': 'loose',
        'check-reset-range': 'strict',
        'cli-audit-log': 'enable',
        'cloud-communication': 'enable',
        'clt-cert-req': 'enable',
        'compliance-check': 'enable',
        'compliance-check-time': 'test_value_51',
        'cpu-use-threshold': '52',
        'csr-ca-attribute': 'enable',
        'daily-restart': 'enable',
        'default-service-source-port': 'test_value_55',
        'device-identification-active-scan-delay': '56',
        'device-idle-timeout': '57',
        'dh-params': '1024',
        'dnsproxy-worker-count': '59',
        'dst': 'enable',
        'endpoint-control-fds-access': 'enable',
        'failtime': '62',
        'fds-statistics': 'enable',
        'fds-statistics-period': '64',
        'fec-port': '65',
        'fortiextender': 'disable',
        'fortiextender-data-port': '67',
        'fortiextender-vlan-mode': 'enable',
        'fortiservice-port': '69',
        'fortitoken-cloud-service': 'enable',
        'gui-certificates': 'enable',
        'gui-custom-language': 'enable',
        'gui-date-format': 'yyyy/MM/dd',
        'gui-date-time-source': 'system',
        'gui-device-latitude': 'test_value_75',
        'gui-device-longitude': 'test_value_76',
        'gui-display-hostname': 'enable',
        'gui-ipv6': 'enable',
        'gui-lines-per-page': '79',
        'gui-theme': 'green',
        'gui-wireless-opensecurity': 'enable',
        'honor-df': 'enable',
        'hostname': 'myhostname83',
        'igmp-state-limit': '84',
        'interval': '85',
        'ip-src-port-range': 'test_value_86',
        'ips-affinity': 'test_value_87',
        'ipsec-asic-offload': 'enable',
        'ipsec-hmac-offload': 'enable',
        'ipsec-soft-dec-async': 'enable',
        'ipv6-accept-dad': '91',
        'ipv6-allow-anycast-probe': 'enable',
        'language': 'english',
        'ldapconntimeout': '94',
        'lldp-reception': 'enable',
        'lldp-transmission': 'enable',
        'log-ssl-connection': 'enable',
        'log-uuid-address': 'enable',
        'log-uuid-policy': 'enable',
        'login-timestamp': 'enable',
        'long-vdom-name': 'enable',
        'management-vdom': 'test_value_102',
        'max-dlpstat-memory': '103',
        'max-route-cache-size': '104',
        'memory-use-threshold-extreme': '105',
        'memory-use-threshold-green': '106',
        'memory-use-threshold-red': '107',
        'miglog-affinity': 'test_value_108',
        'miglogd-children': '109',
        'multi-factor-authentication': 'optional',
        'ndp-max-entry': '111',
        'per-user-bwl': 'enable',
        'policy-auth-concurrent': '113',
        'post-login-banner': 'disable',
        'pre-login-banner': 'enable',
        'private-data-encryption': 'disable',
        'proxy-auth-lifetime': 'enable',
        'proxy-auth-lifetime-timeout': '118',
        'proxy-auth-timeout': '119',
        'proxy-cipher-hardware-acceleration': 'disable',
        'proxy-kxp-hardware-acceleration': 'disable',
        'proxy-re-authentication-mode': 'session',
        'proxy-worker-count': '123',
        'radius-port': '124',
        'reboot-upon-config-restore': 'enable',
        'refresh': '126',
        'remoteauthtimeout': '127',
        'reset-sessionless-tcp': 'enable',
        'restart-time': 'test_value_129',
        'revision-backup-on-logout': 'enable',
        'revision-image-auto-backup': 'enable',
        'scanunit-count': '132',
        'security-rating-result-submission': 'enable',
        'security-rating-run-on-schedule': 'enable',
        'send-pmtu-icmp': 'enable',
        'snat-route-change': 'enable',
        'special-file-23-support': 'disable',
        'ssd-trim-date': '138',
        'ssd-trim-freq': 'never',
        'ssd-trim-hour': '140',
        'ssd-trim-min': '141',
        'ssd-trim-weekday': 'sunday',
        'ssh-cbc-cipher': 'enable',
        'ssh-hmac-md5': 'enable',
        'ssh-kex-sha1': 'enable',
        'ssh-mac-weak': 'enable',
        'ssl-min-proto-version': 'SSLv3',
        'ssl-static-key-ciphers': 'enable',
        'sslvpn-cipher-hardware-acceleration': 'enable',
        'sslvpn-kxp-hardware-acceleration': 'enable',
        'sslvpn-max-worker-count': '151',
        'sslvpn-plugin-version-check': 'enable',
        'strict-dirty-session-check': 'enable',
        'strong-crypto': 'enable',
        'switch-controller': 'disable',
        'switch-controller-reserved-network': 'test_value_156',
        'sys-perf-log-interval': '157',
        'tcp-halfclose-timer': '158',
        'tcp-halfopen-timer': '159',
        'tcp-option': 'enable',
        'tcp-timewait-timer': '161',
        'tftp': 'enable',
                'timezone': '01',
                'traffic-priority': 'tos',
                'traffic-priority-level': 'low',
                'two-factor-email-expiry': '166',
                'two-factor-fac-expiry': '167',
                'two-factor-ftk-expiry': '168',
                'two-factor-ftm-expiry': '169',
                'two-factor-sms-expiry': '170',
                'udp-idle-timer': '171',
                'user-server-cert': 'test_value_172',
                'vdom-mode': 'no-vdom',
                'vip-arp-range': 'unlimited',
                'virtual-server-count': '175',
                'virtual-server-hardware-acceleration': 'disable',
                'wad-affinity': 'test_value_177',
                'wad-csvc-cs-count': '178',
                'wad-csvc-db-count': '179',
                'wad-memory-change-granularity': '180',
                'wad-source-affinity': 'disable',
                'wad-worker-count': '182',
                'wifi-ca-certificate': 'test_value_183',
                'wifi-certificate': 'test_value_184',
                'wimax-4g-usb': 'enable',
                'wireless-controller': 'enable',
                'wireless-controller-port': '187'
    }

    set_method_mock.assert_called_with('system', 'global', data=expected_data, vdom='root')
    schema_method_mock.assert_not_called()
    assert is_error
    assert not changed
    assert response['status'] == 'error'
    assert response['http_status'] == 500


def test_system_global_idempotent(mocker):
    schema_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.schema')

    set_method_result = {'status': 'error', 'http_method': 'DELETE', 'http_status': 404}
    set_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.set', return_value=set_method_result)

    input_data = {
        'username': 'admin',
        'state': 'present',
        'system_global': {
            'admin_concurrent': 'enable',
            'admin_console_timeout': '4',
            'admin_hsts_max_age': '5',
            'admin_http_connection_receive_timeout': '6',
            'admin_https_pki_required': 'enable',
            'admin_https_redirect': 'enable',
            'admin_lockout_duration': '9',
            'admin_lockout_threshold': '10',
            'admin_login_max': '11',
            'admin_maintainer': 'enable',
            'admin_port': '13',
            'admin_restrict_local': 'enable',
            'admin_scp': 'enable',
            'admin_server_cert': 'test_value_16',
            'admin_sport': '17',
            'admin_ssh_grace_time': '18',
            'admin_ssh_password': 'enable',
            'admin_ssh_port': '20',
            'admin_ssh_v1': 'enable',
            'admin_telnet': 'enable',
            'admin_telnet_port': '23',
            'admintimeout': '24',
            'alias': 'test_value_25',
            'allow_traffic_redirect': 'enable',
            'anti_replay': 'disable',
            'arp_max_entry': '28',
            'auth_cert': 'test_value_29',
            'auth_http_port': '30',
            'auth_https_port': '31',
            'auth_keepalive': 'enable',
            'auth_session_limit': 'block-new',
            'auto_auth_extension_device': 'enable',
            'autorun_log_fsck': 'enable',
            'av_affinity': 'test_value_36',
            'av_failopen': 'pass',
            'av_failopen_session': 'enable',
            'batch_cmdb': 'enable',
            'block_session_timer': '40',
            'br_fdb_max_entry': '41',
            'cert_chain_max': '42',
            'cfg_revert_timeout': '43',
            'cfg_save': 'automatic',
            'check_protocol_header': 'loose',
            'check_reset_range': 'strict',
            'cli_audit_log': 'enable',
            'cloud_communication': 'enable',
            'clt_cert_req': 'enable',
            'compliance_check': 'enable',
            'compliance_check_time': 'test_value_51',
            'cpu_use_threshold': '52',
            'csr_ca_attribute': 'enable',
            'daily_restart': 'enable',
            'default_service_source_port': 'test_value_55',
            'device_identification_active_scan_delay': '56',
            'device_idle_timeout': '57',
            'dh_params': '1024',
            'dnsproxy_worker_count': '59',
            'dst': 'enable',
            'endpoint_control_fds_access': 'enable',
            'failtime': '62',
            'fds_statistics': 'enable',
            'fds_statistics_period': '64',
            'fec_port': '65',
            'fortiextender': 'disable',
            'fortiextender_data_port': '67',
            'fortiextender_vlan_mode': 'enable',
            'fortiservice_port': '69',
            'fortitoken_cloud_service': 'enable',
            'gui_certificates': 'enable',
            'gui_custom_language': 'enable',
            'gui_date_format': 'yyyy/MM/dd',
            'gui_date_time_source': 'system',
            'gui_device_latitude': 'test_value_75',
            'gui_device_longitude': 'test_value_76',
            'gui_display_hostname': 'enable',
            'gui_ipv6': 'enable',
            'gui_lines_per_page': '79',
            'gui_theme': 'green',
            'gui_wireless_opensecurity': 'enable',
            'honor_df': 'enable',
            'hostname': 'myhostname83',
            'igmp_state_limit': '84',
            'interval': '85',
            'ip_src_port_range': 'test_value_86',
            'ips_affinity': 'test_value_87',
            'ipsec_asic_offload': 'enable',
            'ipsec_hmac_offload': 'enable',
            'ipsec_soft_dec_async': 'enable',
            'ipv6_accept_dad': '91',
            'ipv6_allow_anycast_probe': 'enable',
            'language': 'english',
            'ldapconntimeout': '94',
            'lldp_reception': 'enable',
            'lldp_transmission': 'enable',
            'log_ssl_connection': 'enable',
            'log_uuid_address': 'enable',
            'log_uuid_policy': 'enable',
            'login_timestamp': 'enable',
            'long_vdom_name': 'enable',
            'management_vdom': 'test_value_102',
            'max_dlpstat_memory': '103',
            'max_route_cache_size': '104',
            'memory_use_threshold_extreme': '105',
            'memory_use_threshold_green': '106',
            'memory_use_threshold_red': '107',
            'miglog_affinity': 'test_value_108',
            'miglogd_children': '109',
            'multi_factor_authentication': 'optional',
            'ndp_max_entry': '111',
            'per_user_bwl': 'enable',
            'policy_auth_concurrent': '113',
            'post_login_banner': 'disable',
            'pre_login_banner': 'enable',
            'private_data_encryption': 'disable',
            'proxy_auth_lifetime': 'enable',
            'proxy_auth_lifetime_timeout': '118',
            'proxy_auth_timeout': '119',
            'proxy_cipher_hardware_acceleration': 'disable',
            'proxy_kxp_hardware_acceleration': 'disable',
            'proxy_re_authentication_mode': 'session',
            'proxy_worker_count': '123',
            'radius_port': '124',
            'reboot_upon_config_restore': 'enable',
            'refresh': '126',
            'remoteauthtimeout': '127',
            'reset_sessionless_tcp': 'enable',
            'restart_time': 'test_value_129',
            'revision_backup_on_logout': 'enable',
            'revision_image_auto_backup': 'enable',
            'scanunit_count': '132',
            'security_rating_result_submission': 'enable',
            'security_rating_run_on_schedule': 'enable',
            'send_pmtu_icmp': 'enable',
            'snat_route_change': 'enable',
            'special_file_23_support': 'disable',
            'ssd_trim_date': '138',
            'ssd_trim_freq': 'never',
            'ssd_trim_hour': '140',
            'ssd_trim_min': '141',
            'ssd_trim_weekday': 'sunday',
            'ssh_cbc_cipher': 'enable',
            'ssh_hmac_md5': 'enable',
            'ssh_kex_sha1': 'enable',
            'ssh_mac_weak': 'enable',
            'ssl_min_proto_version': 'SSLv3',
            'ssl_static_key_ciphers': 'enable',
            'sslvpn_cipher_hardware_acceleration': 'enable',
            'sslvpn_kxp_hardware_acceleration': 'enable',
            'sslvpn_max_worker_count': '151',
            'sslvpn_plugin_version_check': 'enable',
            'strict_dirty_session_check': 'enable',
            'strong_crypto': 'enable',
            'switch_controller': 'disable',
            'switch_controller_reserved_network': 'test_value_156',
            'sys_perf_log_interval': '157',
            'tcp_halfclose_timer': '158',
            'tcp_halfopen_timer': '159',
            'tcp_option': 'enable',
            'tcp_timewait_timer': '161',
            'tftp': 'enable',
            'timezone': '01',
            'traffic_priority': 'tos',
            'traffic_priority_level': 'low',
            'two_factor_email_expiry': '166',
            'two_factor_fac_expiry': '167',
            'two_factor_ftk_expiry': '168',
            'two_factor_ftm_expiry': '169',
            'two_factor_sms_expiry': '170',
            'udp_idle_timer': '171',
            'user_server_cert': 'test_value_172',
            'vdom_mode': 'no-vdom',
            'vip_arp_range': 'unlimited',
            'virtual_server_count': '175',
            'virtual_server_hardware_acceleration': 'disable',
            'wad_affinity': 'test_value_177',
            'wad_csvc_cs_count': '178',
            'wad_csvc_db_count': '179',
            'wad_memory_change_granularity': '180',
            'wad_source_affinity': 'disable',
            'wad_worker_count': '182',
            'wifi_ca_certificate': 'test_value_183',
            'wifi_certificate': 'test_value_184',
            'wimax_4g_usb': 'enable',
            'wireless_controller': 'enable',
            'wireless_controller_port': '187'
        },
        'vdom': 'root'}

    is_error, changed, response = fortios_system_global.fortios_system(input_data, fos_instance)

    expected_data = {
        'admin-concurrent': 'enable',
        'admin-console-timeout': '4',
        'admin-hsts-max-age': '5',
        'admin-http-connection-receive-timeout': '6',
        'admin-https-pki-required': 'enable',
        'admin-https-redirect': 'enable',
        'admin-lockout-duration': '9',
        'admin-lockout-threshold': '10',
        'admin-login-max': '11',
        'admin-maintainer': 'enable',
        'admin-port': '13',
        'admin-restrict-local': 'enable',
        'admin-scp': 'enable',
        'admin-server-cert': 'test_value_16',
        'admin-sport': '17',
        'admin-ssh-grace-time': '18',
        'admin-ssh-password': 'enable',
        'admin-ssh-port': '20',
        'admin-ssh-v1': 'enable',
        'admin-telnet': 'enable',
        'admin-telnet-port': '23',
        'admintimeout': '24',
        'alias': 'test_value_25',
        'allow-traffic-redirect': 'enable',
        'anti-replay': 'disable',
        'arp-max-entry': '28',
        'auth-cert': 'test_value_29',
        'auth-http-port': '30',
        'auth-https-port': '31',
        'auth-keepalive': 'enable',
        'auth-session-limit': 'block-new',
        'auto-auth-extension-device': 'enable',
        'autorun-log-fsck': 'enable',
        'av-affinity': 'test_value_36',
        'av-failopen': 'pass',
        'av-failopen-session': 'enable',
        'batch-cmdb': 'enable',
        'block-session-timer': '40',
        'br-fdb-max-entry': '41',
        'cert-chain-max': '42',
        'cfg-revert-timeout': '43',
        'cfg-save': 'automatic',
        'check-protocol-header': 'loose',
        'check-reset-range': 'strict',
        'cli-audit-log': 'enable',
        'cloud-communication': 'enable',
        'clt-cert-req': 'enable',
        'compliance-check': 'enable',
        'compliance-check-time': 'test_value_51',
        'cpu-use-threshold': '52',
        'csr-ca-attribute': 'enable',
        'daily-restart': 'enable',
        'default-service-source-port': 'test_value_55',
        'device-identification-active-scan-delay': '56',
        'device-idle-timeout': '57',
        'dh-params': '1024',
        'dnsproxy-worker-count': '59',
        'dst': 'enable',
        'endpoint-control-fds-access': 'enable',
        'failtime': '62',
        'fds-statistics': 'enable',
        'fds-statistics-period': '64',
        'fec-port': '65',
        'fortiextender': 'disable',
        'fortiextender-data-port': '67',
        'fortiextender-vlan-mode': 'enable',
        'fortiservice-port': '69',
        'fortitoken-cloud-service': 'enable',
        'gui-certificates': 'enable',
        'gui-custom-language': 'enable',
        'gui-date-format': 'yyyy/MM/dd',
        'gui-date-time-source': 'system',
        'gui-device-latitude': 'test_value_75',
        'gui-device-longitude': 'test_value_76',
        'gui-display-hostname': 'enable',
        'gui-ipv6': 'enable',
        'gui-lines-per-page': '79',
        'gui-theme': 'green',
        'gui-wireless-opensecurity': 'enable',
        'honor-df': 'enable',
        'hostname': 'myhostname83',
        'igmp-state-limit': '84',
        'interval': '85',
        'ip-src-port-range': 'test_value_86',
        'ips-affinity': 'test_value_87',
        'ipsec-asic-offload': 'enable',
        'ipsec-hmac-offload': 'enable',
        'ipsec-soft-dec-async': 'enable',
        'ipv6-accept-dad': '91',
        'ipv6-allow-anycast-probe': 'enable',
        'language': 'english',
        'ldapconntimeout': '94',
        'lldp-reception': 'enable',
        'lldp-transmission': 'enable',
        'log-ssl-connection': 'enable',
        'log-uuid-address': 'enable',
        'log-uuid-policy': 'enable',
        'login-timestamp': 'enable',
        'long-vdom-name': 'enable',
        'management-vdom': 'test_value_102',
        'max-dlpstat-memory': '103',
        'max-route-cache-size': '104',
        'memory-use-threshold-extreme': '105',
        'memory-use-threshold-green': '106',
        'memory-use-threshold-red': '107',
        'miglog-affinity': 'test_value_108',
        'miglogd-children': '109',
        'multi-factor-authentication': 'optional',
        'ndp-max-entry': '111',
        'per-user-bwl': 'enable',
        'policy-auth-concurrent': '113',
        'post-login-banner': 'disable',
        'pre-login-banner': 'enable',
        'private-data-encryption': 'disable',
        'proxy-auth-lifetime': 'enable',
        'proxy-auth-lifetime-timeout': '118',
        'proxy-auth-timeout': '119',
        'proxy-cipher-hardware-acceleration': 'disable',
        'proxy-kxp-hardware-acceleration': 'disable',
        'proxy-re-authentication-mode': 'session',
        'proxy-worker-count': '123',
        'radius-port': '124',
        'reboot-upon-config-restore': 'enable',
        'refresh': '126',
        'remoteauthtimeout': '127',
        'reset-sessionless-tcp': 'enable',
        'restart-time': 'test_value_129',
        'revision-backup-on-logout': 'enable',
        'revision-image-auto-backup': 'enable',
        'scanunit-count': '132',
        'security-rating-result-submission': 'enable',
        'security-rating-run-on-schedule': 'enable',
        'send-pmtu-icmp': 'enable',
        'snat-route-change': 'enable',
        'special-file-23-support': 'disable',
        'ssd-trim-date': '138',
        'ssd-trim-freq': 'never',
        'ssd-trim-hour': '140',
        'ssd-trim-min': '141',
        'ssd-trim-weekday': 'sunday',
        'ssh-cbc-cipher': 'enable',
        'ssh-hmac-md5': 'enable',
        'ssh-kex-sha1': 'enable',
        'ssh-mac-weak': 'enable',
        'ssl-min-proto-version': 'SSLv3',
        'ssl-static-key-ciphers': 'enable',
        'sslvpn-cipher-hardware-acceleration': 'enable',
        'sslvpn-kxp-hardware-acceleration': 'enable',
        'sslvpn-max-worker-count': '151',
        'sslvpn-plugin-version-check': 'enable',
        'strict-dirty-session-check': 'enable',
        'strong-crypto': 'enable',
        'switch-controller': 'disable',
        'switch-controller-reserved-network': 'test_value_156',
        'sys-perf-log-interval': '157',
        'tcp-halfclose-timer': '158',
        'tcp-halfopen-timer': '159',
        'tcp-option': 'enable',
        'tcp-timewait-timer': '161',
        'tftp': 'enable',
                'timezone': '01',
                'traffic-priority': 'tos',
                'traffic-priority-level': 'low',
                'two-factor-email-expiry': '166',
                'two-factor-fac-expiry': '167',
                'two-factor-ftk-expiry': '168',
                'two-factor-ftm-expiry': '169',
                'two-factor-sms-expiry': '170',
                'udp-idle-timer': '171',
                'user-server-cert': 'test_value_172',
                'vdom-mode': 'no-vdom',
                'vip-arp-range': 'unlimited',
                'virtual-server-count': '175',
                'virtual-server-hardware-acceleration': 'disable',
                'wad-affinity': 'test_value_177',
                'wad-csvc-cs-count': '178',
                'wad-csvc-db-count': '179',
                'wad-memory-change-granularity': '180',
                'wad-source-affinity': 'disable',
                'wad-worker-count': '182',
                'wifi-ca-certificate': 'test_value_183',
                'wifi-certificate': 'test_value_184',
                'wimax-4g-usb': 'enable',
                'wireless-controller': 'enable',
                'wireless-controller-port': '187'
    }

    set_method_mock.assert_called_with('system', 'global', data=expected_data, vdom='root')
    schema_method_mock.assert_not_called()
    assert not is_error
    assert not changed
    assert response['status'] == 'error'
    assert response['http_status'] == 404


def test_system_global_filter_foreign_attributes(mocker):
    schema_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.schema')

    set_method_result = {'status': 'success', 'http_method': 'POST', 'http_status': 200}
    set_method_mock = mocker.patch('ansible.module_utils.network.fortios.fortios.FortiOSHandler.set', return_value=set_method_result)

    input_data = {
        'username': 'admin',
        'state': 'present',
        'system_global': {
            'random_attribute_not_valid': 'tag',
            'admin_concurrent': 'enable',
            'admin_console_timeout': '4',
            'admin_hsts_max_age': '5',
            'admin_http_connection_receive_timeout': '6',
            'admin_https_pki_required': 'enable',
            'admin_https_redirect': 'enable',
            'admin_lockout_duration': '9',
            'admin_lockout_threshold': '10',
            'admin_login_max': '11',
            'admin_maintainer': 'enable',
            'admin_port': '13',
            'admin_restrict_local': 'enable',
            'admin_scp': 'enable',
            'admin_server_cert': 'test_value_16',
            'admin_sport': '17',
            'admin_ssh_grace_time': '18',
            'admin_ssh_password': 'enable',
            'admin_ssh_port': '20',
            'admin_ssh_v1': 'enable',
            'admin_telnet': 'enable',
            'admin_telnet_port': '23',
            'admintimeout': '24',
            'alias': 'test_value_25',
            'allow_traffic_redirect': 'enable',
            'anti_replay': 'disable',
            'arp_max_entry': '28',
            'auth_cert': 'test_value_29',
            'auth_http_port': '30',
            'auth_https_port': '31',
            'auth_keepalive': 'enable',
            'auth_session_limit': 'block-new',
            'auto_auth_extension_device': 'enable',
            'autorun_log_fsck': 'enable',
            'av_affinity': 'test_value_36',
            'av_failopen': 'pass',
            'av_failopen_session': 'enable',
            'batch_cmdb': 'enable',
            'block_session_timer': '40',
            'br_fdb_max_entry': '41',
            'cert_chain_max': '42',
            'cfg_revert_timeout': '43',
            'cfg_save': 'automatic',
            'check_protocol_header': 'loose',
            'check_reset_range': 'strict',
            'cli_audit_log': 'enable',
            'cloud_communication': 'enable',
            'clt_cert_req': 'enable',
            'compliance_check': 'enable',
            'compliance_check_time': 'test_value_51',
            'cpu_use_threshold': '52',
            'csr_ca_attribute': 'enable',
            'daily_restart': 'enable',
            'default_service_source_port': 'test_value_55',
            'device_identification_active_scan_delay': '56',
            'device_idle_timeout': '57',
            'dh_params': '1024',
            'dnsproxy_worker_count': '59',
            'dst': 'enable',
            'endpoint_control_fds_access': 'enable',
            'failtime': '62',
            'fds_statistics': 'enable',
            'fds_statistics_period': '64',
            'fec_port': '65',
            'fortiextender': 'disable',
            'fortiextender_data_port': '67',
            'fortiextender_vlan_mode': 'enable',
            'fortiservice_port': '69',
            'fortitoken_cloud_service': 'enable',
            'gui_certificates': 'enable',
            'gui_custom_language': 'enable',
            'gui_date_format': 'yyyy/MM/dd',
            'gui_date_time_source': 'system',
            'gui_device_latitude': 'test_value_75',
            'gui_device_longitude': 'test_value_76',
            'gui_display_hostname': 'enable',
            'gui_ipv6': 'enable',
            'gui_lines_per_page': '79',
            'gui_theme': 'green',
            'gui_wireless_opensecurity': 'enable',
            'honor_df': 'enable',
            'hostname': 'myhostname83',
            'igmp_state_limit': '84',
            'interval': '85',
            'ip_src_port_range': 'test_value_86',
            'ips_affinity': 'test_value_87',
            'ipsec_asic_offload': 'enable',
            'ipsec_hmac_offload': 'enable',
            'ipsec_soft_dec_async': 'enable',
            'ipv6_accept_dad': '91',
            'ipv6_allow_anycast_probe': 'enable',
            'language': 'english',
            'ldapconntimeout': '94',
            'lldp_reception': 'enable',
            'lldp_transmission': 'enable',
            'log_ssl_connection': 'enable',
            'log_uuid_address': 'enable',
            'log_uuid_policy': 'enable',
            'login_timestamp': 'enable',
            'long_vdom_name': 'enable',
            'management_vdom': 'test_value_102',
            'max_dlpstat_memory': '103',
            'max_route_cache_size': '104',
            'memory_use_threshold_extreme': '105',
            'memory_use_threshold_green': '106',
            'memory_use_threshold_red': '107',
            'miglog_affinity': 'test_value_108',
            'miglogd_children': '109',
            'multi_factor_authentication': 'optional',
            'ndp_max_entry': '111',
            'per_user_bwl': 'enable',
            'policy_auth_concurrent': '113',
            'post_login_banner': 'disable',
            'pre_login_banner': 'enable',
            'private_data_encryption': 'disable',
            'proxy_auth_lifetime': 'enable',
            'proxy_auth_lifetime_timeout': '118',
            'proxy_auth_timeout': '119',
            'proxy_cipher_hardware_acceleration': 'disable',
            'proxy_kxp_hardware_acceleration': 'disable',
            'proxy_re_authentication_mode': 'session',
            'proxy_worker_count': '123',
            'radius_port': '124',
            'reboot_upon_config_restore': 'enable',
            'refresh': '126',
            'remoteauthtimeout': '127',
            'reset_sessionless_tcp': 'enable',
            'restart_time': 'test_value_129',
            'revision_backup_on_logout': 'enable',
            'revision_image_auto_backup': 'enable',
            'scanunit_count': '132',
            'security_rating_result_submission': 'enable',
            'security_rating_run_on_schedule': 'enable',
            'send_pmtu_icmp': 'enable',
            'snat_route_change': 'enable',
            'special_file_23_support': 'disable',
            'ssd_trim_date': '138',
            'ssd_trim_freq': 'never',
            'ssd_trim_hour': '140',
            'ssd_trim_min': '141',
            'ssd_trim_weekday': 'sunday',
            'ssh_cbc_cipher': 'enable',
            'ssh_hmac_md5': 'enable',
            'ssh_kex_sha1': 'enable',
            'ssh_mac_weak': 'enable',
            'ssl_min_proto_version': 'SSLv3',
            'ssl_static_key_ciphers': 'enable',
            'sslvpn_cipher_hardware_acceleration': 'enable',
            'sslvpn_kxp_hardware_acceleration': 'enable',
            'sslvpn_max_worker_count': '151',
            'sslvpn_plugin_version_check': 'enable',
            'strict_dirty_session_check': 'enable',
            'strong_crypto': 'enable',
            'switch_controller': 'disable',
            'switch_controller_reserved_network': 'test_value_156',
            'sys_perf_log_interval': '157',
            'tcp_halfclose_timer': '158',
            'tcp_halfopen_timer': '159',
            'tcp_option': 'enable',
            'tcp_timewait_timer': '161',
            'tftp': 'enable',
            'timezone': '01',
            'traffic_priority': 'tos',
            'traffic_priority_level': 'low',
            'two_factor_email_expiry': '166',
            'two_factor_fac_expiry': '167',
            'two_factor_ftk_expiry': '168',
            'two_factor_ftm_expiry': '169',
            'two_factor_sms_expiry': '170',
            'udp_idle_timer': '171',
            'user_server_cert': 'test_value_172',
            'vdom_mode': 'no-vdom',
            'vip_arp_range': 'unlimited',
            'virtual_server_count': '175',
            'virtual_server_hardware_acceleration': 'disable',
            'wad_affinity': 'test_value_177',
            'wad_csvc_cs_count': '178',
            'wad_csvc_db_count': '179',
            'wad_memory_change_granularity': '180',
            'wad_source_affinity': 'disable',
            'wad_worker_count': '182',
            'wifi_ca_certificate': 'test_value_183',
            'wifi_certificate': 'test_value_184',
            'wimax_4g_usb': 'enable',
            'wireless_controller': 'enable',
            'wireless_controller_port': '187'
        },
        'vdom': 'root'}

    is_error, changed, response = fortios_system_global.fortios_system(input_data, fos_instance)

    expected_data = {
        'admin-concurrent': 'enable',
        'admin-console-timeout': '4',
        'admin-hsts-max-age': '5',
        'admin-http-connection-receive-timeout': '6',
        'admin-https-pki-required': 'enable',
        'admin-https-redirect': 'enable',
        'admin-lockout-duration': '9',
        'admin-lockout-threshold': '10',
        'admin-login-max': '11',
        'admin-maintainer': 'enable',
        'admin-port': '13',
        'admin-restrict-local': 'enable',
        'admin-scp': 'enable',
        'admin-server-cert': 'test_value_16',
        'admin-sport': '17',
        'admin-ssh-grace-time': '18',
        'admin-ssh-password': 'enable',
        'admin-ssh-port': '20',
        'admin-ssh-v1': 'enable',
        'admin-telnet': 'enable',
        'admin-telnet-port': '23',
        'admintimeout': '24',
        'alias': 'test_value_25',
        'allow-traffic-redirect': 'enable',
        'anti-replay': 'disable',
        'arp-max-entry': '28',
        'auth-cert': 'test_value_29',
        'auth-http-port': '30',
        'auth-https-port': '31',
        'auth-keepalive': 'enable',
        'auth-session-limit': 'block-new',
        'auto-auth-extension-device': 'enable',
        'autorun-log-fsck': 'enable',
        'av-affinity': 'test_value_36',
        'av-failopen': 'pass',
        'av-failopen-session': 'enable',
        'batch-cmdb': 'enable',
        'block-session-timer': '40',
        'br-fdb-max-entry': '41',
        'cert-chain-max': '42',
        'cfg-revert-timeout': '43',
        'cfg-save': 'automatic',
        'check-protocol-header': 'loose',
        'check-reset-range': 'strict',
        'cli-audit-log': 'enable',
        'cloud-communication': 'enable',
        'clt-cert-req': 'enable',
        'compliance-check': 'enable',
        'compliance-check-time': 'test_value_51',
        'cpu-use-threshold': '52',
        'csr-ca-attribute': 'enable',
        'daily-restart': 'enable',
        'default-service-source-port': 'test_value_55',
        'device-identification-active-scan-delay': '56',
        'device-idle-timeout': '57',
        'dh-params': '1024',
        'dnsproxy-worker-count': '59',
        'dst': 'enable',
        'endpoint-control-fds-access': 'enable',
        'failtime': '62',
        'fds-statistics': 'enable',
        'fds-statistics-period': '64',
        'fec-port': '65',
        'fortiextender': 'disable',
        'fortiextender-data-port': '67',
        'fortiextender-vlan-mode': 'enable',
        'fortiservice-port': '69',
        'fortitoken-cloud-service': 'enable',
        'gui-certificates': 'enable',
        'gui-custom-language': 'enable',
        'gui-date-format': 'yyyy/MM/dd',
        'gui-date-time-source': 'system',
        'gui-device-latitude': 'test_value_75',
        'gui-device-longitude': 'test_value_76',
        'gui-display-hostname': 'enable',
        'gui-ipv6': 'enable',
        'gui-lines-per-page': '79',
        'gui-theme': 'green',
        'gui-wireless-opensecurity': 'enable',
        'honor-df': 'enable',
        'hostname': 'myhostname83',
        'igmp-state-limit': '84',
        'interval': '85',
        'ip-src-port-range': 'test_value_86',
        'ips-affinity': 'test_value_87',
        'ipsec-asic-offload': 'enable',
        'ipsec-hmac-offload': 'enable',
        'ipsec-soft-dec-async': 'enable',
        'ipv6-accept-dad': '91',
        'ipv6-allow-anycast-probe': 'enable',
        'language': 'english',
        'ldapconntimeout': '94',
        'lldp-reception': 'enable',
        'lldp-transmission': 'enable',
        'log-ssl-connection': 'enable',
        'log-uuid-address': 'enable',
        'log-uuid-policy': 'enable',
        'login-timestamp': 'enable',
        'long-vdom-name': 'enable',
        'management-vdom': 'test_value_102',
        'max-dlpstat-memory': '103',
        'max-route-cache-size': '104',
        'memory-use-threshold-extreme': '105',
        'memory-use-threshold-green': '106',
        'memory-use-threshold-red': '107',
        'miglog-affinity': 'test_value_108',
        'miglogd-children': '109',
        'multi-factor-authentication': 'optional',
        'ndp-max-entry': '111',
        'per-user-bwl': 'enable',
        'policy-auth-concurrent': '113',
        'post-login-banner': 'disable',
        'pre-login-banner': 'enable',
        'private-data-encryption': 'disable',
        'proxy-auth-lifetime': 'enable',
        'proxy-auth-lifetime-timeout': '118',
        'proxy-auth-timeout': '119',
        'proxy-cipher-hardware-acceleration': 'disable',
        'proxy-kxp-hardware-acceleration': 'disable',
        'proxy-re-authentication-mode': 'session',
        'proxy-worker-count': '123',
        'radius-port': '124',
        'reboot-upon-config-restore': 'enable',
        'refresh': '126',
        'remoteauthtimeout': '127',
        'reset-sessionless-tcp': 'enable',
        'restart-time': 'test_value_129',
        'revision-backup-on-logout': 'enable',
        'revision-image-auto-backup': 'enable',
        'scanunit-count': '132',
        'security-rating-result-submission': 'enable',
        'security-rating-run-on-schedule': 'enable',
        'send-pmtu-icmp': 'enable',
        'snat-route-change': 'enable',
        'special-file-23-support': 'disable',
        'ssd-trim-date': '138',
        'ssd-trim-freq': 'never',
        'ssd-trim-hour': '140',
        'ssd-trim-min': '141',
        'ssd-trim-weekday': 'sunday',
        'ssh-cbc-cipher': 'enable',
        'ssh-hmac-md5': 'enable',
        'ssh-kex-sha1': 'enable',
        'ssh-mac-weak': 'enable',
        'ssl-min-proto-version': 'SSLv3',
        'ssl-static-key-ciphers': 'enable',
        'sslvpn-cipher-hardware-acceleration': 'enable',
        'sslvpn-kxp-hardware-acceleration': 'enable',
        'sslvpn-max-worker-count': '151',
        'sslvpn-plugin-version-check': 'enable',
        'strict-dirty-session-check': 'enable',
        'strong-crypto': 'enable',
        'switch-controller': 'disable',
        'switch-controller-reserved-network': 'test_value_156',
        'sys-perf-log-interval': '157',
        'tcp-halfclose-timer': '158',
        'tcp-halfopen-timer': '159',
        'tcp-option': 'enable',
        'tcp-timewait-timer': '161',
        'tftp': 'enable',
                'timezone': '01',
                'traffic-priority': 'tos',
                'traffic-priority-level': 'low',
                'two-factor-email-expiry': '166',
                'two-factor-fac-expiry': '167',
                'two-factor-ftk-expiry': '168',
                'two-factor-ftm-expiry': '169',
                'two-factor-sms-expiry': '170',
                'udp-idle-timer': '171',
                'user-server-cert': 'test_value_172',
                'vdom-mode': 'no-vdom',
                'vip-arp-range': 'unlimited',
                'virtual-server-count': '175',
                'virtual-server-hardware-acceleration': 'disable',
                'wad-affinity': 'test_value_177',
                'wad-csvc-cs-count': '178',
                'wad-csvc-db-count': '179',
                'wad-memory-change-granularity': '180',
                'wad-source-affinity': 'disable',
                'wad-worker-count': '182',
                'wifi-ca-certificate': 'test_value_183',
                'wifi-certificate': 'test_value_184',
                'wimax-4g-usb': 'enable',
                'wireless-controller': 'enable',
                'wireless-controller-port': '187'
    }

    set_method_mock.assert_called_with('system', 'global', data=expected_data, vdom='root')
    schema_method_mock.assert_not_called()
    assert not is_error
    assert changed
    assert response['status'] == 'success'
    assert response['http_status'] == 200
